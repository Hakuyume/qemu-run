[Unit]
Description=QEMU virtual machine %i
After=network.target

[Service]
Type=simple
Group=wheel
UMask=002
ExecStartPre=/usr/bin/install -D /usr/share/ovmf/x64/OVMF_VARS.fd /tmp/qemu-%i/OVMF_VARS.fd
ExecStart=/usr/bin/qemu-run /etc/qemu/%i.yaml
ExecStop=/usr/bin/socat system:'echo system_powerdown' /tmp/qemu-%i/monitor.sock
ExecStopPost=/usr/bin/rm -r /tmp/qemu-%i
TimeoutStopSec=300
KillMode=none

[Install]
WantedBy=multi-user.target
